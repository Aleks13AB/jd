-- 1
SELECT film.ocena, COUNT(*) AS liczba_filmow
FROM film
GROUP BY film.ocena;

-- 2
SELECT kategoria.nazwa, COUNT(*) AS liczba_filmow
FROM film
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;

-- 3
SELECT film.tytul, COUNT(*) AS liczba_aktorow
FROM film
JOIN film_aktor ON film.film_id = film_aktor.film_id
GROUP BY film.tytul;

-- 4
SELECT platnosc.klient_id, SUM(platnosc.kwota) AS suma_platnosci
FROM platnosc
GROUP BY platnosc.klient_id;

-- 5
SELECT film.tytul, SUM(platnosc.kwota) AS suma_platnosci
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
GROUP BY film.tytul;


-- 6
SELECT kategoria.nazwa,
       AVG(film.stawka_wypozycz) AS srednia_cena_wypozyczenia,
       AVG(film.koszty_wymiany) AS sredni_koszt_wymiany
FROM film
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;

-- 7
SELECT platnosc.klient_id,
       AVG(platnosc.kwota) AS srednia_kwota
FROM platnosc
GROUP BY platnosc.klient_id;



-- 8
SELECT platnosc.pracownik_id,
       AVG(platnosc.kwota) AS srednia_kwota
FROM platnosc
GROUP BY platnosc.pracownik_id;


-- 9
SELECT adres.adres,
       AVG(platnosc.kwota) AS srednia_kwota
FROM adres
JOIN sklep ON adres.adres_id = sklep.adres_id
JOIN pracownik ON sklep.sklep_id = pracownik.sklep_id
JOIN platnosc ON pracownik.pracownik_id = platnosc.pracownik_id
GROUP BY adres.adres;



-- 10
SELECT kategoria.nazwa,
       AVG(platnosc.kwota) AS srednia,
       MAX(platnosc.kwota) AS maks,
       MIN(platnosc.kwota) AS min,
       SUM(platnosc.kwota) AS suma
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;



-- 11
SELECT platnosc.klient_id,
       SUM(platnosc.kwota) AS suma,
       MAX(platnosc.kwota) AS maks,
       MIN(platnosc.kwota) AS min
FROM platnosc
GROUP BY platnosc.klient_id;



-- 12
SELECT klient.nazwisko,
       COUNT(wypozyczenie.wypozyczenie_id) AS liczba_wypozyczen
FROM klient
JOIN wypozyczenie ON klient.klient_id = wypozyczenie.klient_id
GROUP BY klient.nazwisko;



-- 13
SELECT platnosc.klient_id,
       COUNT(platnosc.platnosc_id) AS liczba_platnosci
FROM platnosc
GROUP BY platnosc.klient_id;



-- 14
SELECT platnosc.klient_id,
       VARIANCE(platnosc.kwota) AS wariancja,
       AVG(platnosc.kwota) AS srednia,
       STDDEV(platnosc.kwota) AS odchylenie_standardowe
FROM platnosc
GROUP BY platnosc.klient_id;


-- 15
SELECT film.tytul,
       VARIANCE(platnosc.kwota) AS wariancja,
       AVG(platnosc.kwota) AS srednia,
       STDDEV(platnosc.kwota) AS odchylenie_standardowe
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
GROUP BY film.tytul;



-- 16
SELECT kategoria.nazwa,
       VARIANCE(platnosc.kwota) AS wariancja,
       AVG(platnosc.kwota) AS srednia,
       STDDEV(platnosc.kwota) AS odchylenie_standardowe
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
JOIN film_kategoria ON film.film_id = film_kategoria.film_id
JOIN kategoria ON film_kategoria.kategoria_id = kategoria.kategoria_id
GROUP BY kategoria.nazwa;


-- 17
SELECT platnosc.klient_id,
       SUM(platnosc.kwota) AS suma_platnosci
FROM platnosc
GROUP BY platnosc.klient_id
HAVING SUM(platnosc.kwota) > 200;



-- 18
SELECT film.tytul,
       SUM(platnosc.kwota) AS suma_platnosci
FROM platnosc
JOIN wypozyczenie ON platnosc.wypozyczenie_id = wypozyczenie.wypozyczenie_id
JOIN spis ON wypozyczenie.spis_id = spis.spis_id
JOIN film ON spis.film_id = film.film_id
GROUP BY film.tytul
HAVING SUM(platnosc.kwota) > 200;
